---

- name: Apache | set up directories
  file: path={{ item.path }} state=directory recurse=yes
  with_items:
  - {
    path: "{{ apache_home_dir }}/default",
  }
  tags: apache
  
  
- name: Apache | Create www-admin group for web
  group: 
    name: www-admin
    state: present
  tags: apache
  
  
# Note this module requires the package python-passlib  
- name: Apache | Create User password in Auth file
  htpasswd: 
     path="{{ apache_auth_htpasswd_file }}"
     name="{{ item.username }}"
     password="{{ item.password }}"
     owner=root 
     group=www-data 
     mode=0640
  with_items:
    -  "{{ apache_auth_users }}"
    
# Todo write the authgroup file
# adding relevant users to groups
# see https://www.linode.com/docs/websites/authbased-access-control-with-apache    
    
    

# Apache user www-data is created on install of apache
#- name: Apache | Add apache www-data user
#  user: name=www-data
#        groups=www-admin
#        append=yes
#        group=www-data
#  sudo: true